= 配置树梅派

== 系统下载与安装

树梅派 https://www.raspberrypi.com/software/[官方] 很贴心的提供了Ubuntu、Windoes、MacOS下的镜安装工具，
由于这里我使用的是ArchLinux所以不再对此过多赘述，我选择了手动下载镜像然后使用 `dd` 命令手动写入的方式。

.下载完包含镜像的zip包后对其进行解压
[source, bash]
----
unar 2021-10-30-raspios-bullseye-armhf-lite.zip
----

NOTE:: 这里需要注意一定要确保 `dd` 命令的 `of` 选项后所跟设备文件名准确无误后再摁下回车。
否则在你一通行云流水的操作后，很可能随之而来的是后悔莫及。

.之后插入内存卡将镜像写入
[source, bash]
----
sudo dd if=2021-10-30-raspios-bullseye-armhf-lite.img of=/dev/sdb
----

== 系统配置

这里我并不想连接外接显示器，并且希望通过WIFI进行网络连接，
所以直接挂载树梅派的 `boot` 分区进行相应配置。

详情可参考官方文档

* https://www.raspberrypi.com/documentation/computers/configuration.html#setting-up-a-headless-raspberry-pi[Setting up a Headless Raspberry Pi]
* https://www.raspberrypi.com/documentation/computers/remote-access.html#ssh[Setting up an SSH Server]

.挂载 `boot` 分区
[source, bash]
----
mkdir rpi
sudo mount /dev/sdb1 rpi
----

=== SSH配置

.开启SSH
[source, bash]
----
cd rpi 
sudo touch ssh
----

=== WIFI配置

INFO:: 如果本机没有wpa_passphrase 命令可以到Wireshark提供的工具 https://www.wireshark.org/tools/wpa-psk.html[在线生成PSK]

.使用 `wpa_passphrase` 命令生成 `wpa_supplicant` 配置
[source, bash]
----
wpa_passphrase 你的WIFI 你的WIFI密码
----
.生成如下内容（记得把注释掉的原始密码删除）
----
network={
	ssid="你的WIFI"
	#psk="你的WIFI密码"
	psk=07b00558311240a51c1caf3007ba4dc9c0140a5b1589e64c6361e9b2b0367eb5
}
----

.最后拼接成下面这样写入到 `./rpi/wpa_supplicant.conf` 中
[source, plantext]
----
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=CN

network={
	ssid="你的WIFI"
	psk=07b00558311240a51c1caf3007ba4dc9c0140a5b1589e64c6361e9b2b0367eb5
}
----

.一切就绪，最后记得卸载分区
[source, bash]
----
sudo umount rpi
----

之后把内存卡插到树梅派中接通电源开机，静静等待WIFI连接后即可以通过SSH连接树梅派了。

NOTE:: 树梅派默认用户名为： *pi* 密码为： *raspberry* 。
